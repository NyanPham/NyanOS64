#include "cursor.h"
#include "drivers/mouse.h"
#include "drivers/video.h"
#include "kern_defs.h"

static CursorType curr_cursor_type = CURSOR_ARROW;

static const uint8_t bitmap_arrow[CURSOR_H][CURSOR_W] = {
    {1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 2, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0},
    {1, 2, 2, 2, 1, 0, 0, 0, 0, 0, 0, 0},
    {1, 2, 2, 2, 2, 1, 0, 0, 0, 0, 0, 0},
    {1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0, 0},
    {1, 2, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0},
    {1, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0, 0},
    {1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0},
    {1, 2, 2, 2, 2, 2, 1, 1, 1, 1, 0, 0},
    {1, 2, 2, 2, 1, 2, 1, 0, 0, 0, 0, 0},
    {1, 2, 1, 2, 1, 2, 1, 0, 0, 0, 0, 0},
    {1, 1, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
};

static const uint8_t bitmap_resize_h[CURSOR_H][CURSOR_W] = {
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0},
    {0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0},
    {1, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0, 0},
    {0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0},
    {0, 0, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
};

static const uint8_t bitmap_resize_v[CURSOR_H][CURSOR_W] = {
    {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
};

static const uint8_t bitmap_move[CURSOR_H][CURSOR_W] = {
    {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0},
    {0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0},
    {1, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0, 0},
    {0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0},
    {0, 0, 1, 2, 2, 2, 1, 0, 0, 0, 0, 0},
    {0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
};

void cursor_init()
{
    curr_cursor_type = CURSOR_ARROW;
}

void cursor_set_shape(CursorType type)
{
    curr_cursor_type = type;
}

void draw_mouse()
{
    int64_t mx = mouse_get_x();
    int64_t my = mouse_get_y();

    const uint8_t (*curr_bitmap)[CURSOR_W];
    
    switch (curr_cursor_type)
    {
    case CURSOR_RESIZE_H:
        curr_bitmap = bitmap_resize_h; 
        break;
    case CURSOR_RESIZE_V:
        curr_bitmap = bitmap_resize_v; 
        break;
    case CURSOR_MOVE:
        curr_bitmap = bitmap_move; 
        break;
    default:
        curr_bitmap = bitmap_arrow; 
        break;
    }

    for (int y = 0; y < CURSOR_H; y++)
    {
        for (int x = 0; x < CURSOR_W; x++)
        {   
            uint8_t pix_typ = curr_bitmap[y][x];
            if (pix_typ == 0)
            {
                continue;
            }
            uint32_t color = (pix_typ == 1) ? Black : White;
            video_plot_pixel(mx + x, my + y, color);
        }
    }
}